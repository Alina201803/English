### working with excel spreadsheets

2018-09-24

```python
In [1]:  import openpyxl

In [2]: wb = openpyxl.load_workbook('example.xlsx')

In [3]:  type(wb)
Out[3]: openpyxl.workbook.workbook.Workbook

In [4]:  import openpyxl

In [5]: wb = openpyxl.load_workbook('example.xlsx')

In [6]: wb.get_sheet_names()
Out[6]: ['Sheet1', 'Sheet2', 'Sheet3']

In [7]:  sheet = wb.get_sheet_by_name('Sheet3')

In [8]:  type(sheet)


In [9]: sheet.title
Out[9]: 'Sheet3'

In [10]: anotherSheet = wb.get_active_sheet()
D:\Anaconda\lib\site-packages\openpyxl\workbook\workbook.py:102: UserWarning: Call to deprecated function or class get_active_sheet (Use the .active
  def get_active_sheet(self):


In [9]: sheet.title
Out[9]: 'Sheet3'

                                                                                                 
In [14]: import openpyxl

In [15]: wb = openpyxl.load_workbook('example.xlsx')

In [16]:  sheet = wb.get_sheet_by_name('Sheet1')

In [17]: sheet['A1']
Out[17]: <Cell Sheet1.A1>

In [18]: sheet['A1'].value
Out[18]: datetime.datetime(2015, 4, 5, 13, 34, 2)

In [19]: c = sheet['B1']

In [20]: c.value
Out[20]: 'Apples'

In [21]:  'Row ' + str(c.row) + ', Column ' + c.column + ' is
    ...:  ' + c.value
Out[21]: 'Row 1, Column B is Apples'

In [22]: 'Cell ' + c.coordinate + ' is ' + c.value
Out[22]: 'Cell B1 is Apples'

In [23]:  sheet['C1'].value
Out[23]: 73
                                                                                                                                     

In [24]: sheet.cell(row=1, column=2)
Out[24]: <Cell Sheet1.B1>
In [25]: sheet.cell(row=1, column=2).value
Out[25]: 'Apples'

In [26]:  for i in range(1, 8, 2):
    ...:
    ...:     print(i, sheet.cell(row=i, column=2).value)

1 Apples
3 Pears
5 Apples
7 Strawberries

In [27]:  import openpyxl

In [28]: wb = openpyxl.load_workbook('example.xlsx')

In [29]: sheet = wb.get_sheet_by_name('Sheet1')

In [30]: sheet.get_highest_row()
Out[30]: 7

In [33]: import openpyxl

In [34]: from openpyxl.cell import get_column_letter, column_
    ...: index_from_string

In [35]: get_column_letter(1)
Out[35]: 'A'

In [36]: get_column_letter(2)
Out[36]: 'B'

In [37]: get_column_letter(27)
Out[37]: 'AA'

In [38]: get_column_letter(900)
Out[38]: 'AHP'

In [39]: wb = openpyxl.load_workbook('example.xlsx')

In [40]:  sheet = wb.get_sheet_by_name('Sheet1')

In [41]: get_column_letter(sheet.get_highest_column()
Out[41]: 'C'

In [42]:  column_index_from_string('A')
Out[42]: 1

In [43]: column_index_from_string('AA')
Out[43]: 27

In [44]: import openpyxl

In [45]: wb = openpyxl.load_workbook('example.xlsx')

In [46]: sheet = wb.get_sheet_by_name('Sheet1')

In [47]: tuple(sheet['A1':'C3'])
Out[47]:
((<Cell Sheet1.A1>, <Cell Sheet1.B1>, <Cell Sheet1.C1>),
 (<Cell Sheet1.A2>, <Cell Sheet1.B2>, <Cell Sheet1.C2>),
 (<Cell Sheet1.A3>, <Cell Sheet1.B3>, <Cell Sheet1.C3>))

In [48]:  for rowOfCellObjects in sheet['A1':'C3']:
    ...:     for cellObj in rowOfCellObjects:
    ...:        print(cellObj.coordinate, cellObj.value)
    ...: print('--- END OF ROW ---')
    ...:
A1 2015-04-05 13:34:02
B1 Apples
C1 73
A2 2015-04-05 03:41:23
B2 Cherries
C2 85
A3 2015-04-06 12:46:51
B3 Pears
C3 14
--- END OF ROW ---

In [49]: import openpyxl

In [50]: wb = openpyxl.load_workbook('example.xlsx')

In [51]: sheet = wb.get_active_sheet()
D:\Anaconda\lib\site-packages\openpyxl\workbook\workbook.py:10
2: UserWarning: Call to deprecated function or class get_activ
e_sheet (Use the .active property).
  def get_active_sheet(self):

In [52]: sheet.columns[1]
Out[52]:
(<Cell Sheet1.B1>,
 <Cell Sheet1.B2>,
 <Cell Sheet1.B3>,
 <Cell Sheet1.B4>,
 <Cell Sheet1.B5>,
 <Cell Sheet1.B6>,
 <Cell Sheet1.B7>)

In [53]:  for cellObj in sheet.columns[1]:
    ...:     print(cellObj.value)
    ...:
Apples
Cherries
Pears
Oranges
Apples
Bananas
Strawberries

project1
#! python3
# readCensusExcel.py - Tabulates population and number of census tracts for 
# each county.

import openpyxl, pprint
print('Opening workbook...')
wb = openpyxl.load_workbook('censuspopdata.xlsx')
sheet = wb.get_sheet_by_name('Population by Census Tract')
countyData = {}
# Fill in countyData with each county's population and tracts.
print('Reading rows...')
for row in range(2, sheet.get_highest_row() + 1):
    # Each row in the spreadsheet has data for one census tract.
    state  = sheet['B' + str(row)].value
    county = sheet['C' + str(row)].value
    pop    = sheet['D' + str(row)].value

    # Make sure the key for this state exists.
    countyData.setdefault(state, {})
    # Make sure the key for this county in this state exists.
    countyData[state].setdefault(county, {'tracts': 0, 'pop': 0})

    # Each row represents one census tract, so increment by one.
    countyData[state][county]['tracts'] += 1
    # Increase the county pop by the pop in this census tract.
    countyData[state][county]['pop'] += int(pop)

# Open a new text file and write the contents of countyData to it.
print('Writing results...')
resultFile = open('census2010.py', 'w')
resultFile.write('allData = ' + pprint.pformat(countyData))
resultFile.close()
print('Done.')
In [3]: import census2010
In [5]: census2010.allData['AK']['Anchorage']
Out[5]: {'pop': 291826, 'tracts': 55}

In [6]: anchoragePop = census2010.allData['AK']['Anchorage'][
   ...: 'pop']

In [7]: print('THE 2010 population of Anchorage was ' + str(a
   ...: nchoragePop))
THE 2010 population of Anchorage was 291826


```

**今日所学**

reading Excel documents

opening excel documents with OpenPyXL

getting sheets from the Workbook

Getting cells from the sheets

converting between column letters and numbers

getting rows and column from the sheets

project reading data from a spreadsheet

